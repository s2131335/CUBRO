<%- include('./head.ejs') %>

<body>
    <div
        class="alert alert-danger fade show"
        id="err"
        style="display: none"
    ></div>
    <div class="container-fluid text-center" style="width: 1000px">
        <div class="text-center text-primary" style="margin-top: 15%">
            <h1>Welcome to</h1>
            <h1 class="text-dark">CUBRO</h1>
        </div>

        <!-- Email input -->
        <form class="requires-validation" novalidate>
            <div class="row justify-content-md-center" style="margin-top: 5%">
                <div class="col"></div>
                <div class="col-5">
                    <div
                        class="input-group form-outline"
                        style="margin-bottom: 30px"
                    >
                        <input
                            type="email"
                            id="email"
                            class="form-control needs-validation"
                            required
                            pattern="^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$"
                        />

                        <label class="form-label" for="email"
                            ><i class="fas fa-envelope"></i> Email</label
                        >
                        <div class="invalid-feedback">Invalid email</div>
                    </div>
                </div>

                <div class="col"></div>
            </div>

            <!-- Password input -->
            <div class="row justify-content-md-center">
                <div class="col"></div>

                <div class="col-5">
                    <div class="input-group form-outline mb-4">
                        <input
                            type="password"
                            id="password"
                            class="form-control needs-validation"
                            minlength="8"
                            required
                        />
                        <label class="form-label" for="password"
                            ><i class="fas fa-key"></i> Password</label
                        >
                        <div class="vr vr-blurry"></div>
                        <a
                            class="button text-muted shadow-0 pt-1 ps-3 pe-3"
                            href="./forget"
                            >Forgot?</a
                        >
                        <div class="invalid-feedback">Invalid password</div>
                    </div>
                </div>

                <div class="col"></div>
            </div>

            <!-- 2 column grid layout for inline styling -->
            <div class="row justify-content-md-center">
                <div class="col"></div>
                <!-- Rememberme Checkbox -->
                <div class="col-2 pt-1">
                    <input
                        class="form-check-input"
                        type="checkbox"
                        id="rememberme"
                    />
                    <label class="form-check-label" for="rememberme">
                        Remember me
                    </label>
                </div>
                <!-- Submit button -->
                <div class="col-2">
                    <button
                        class="btn btn-primary btn-block shadow-0 mb-4"
                        type="button"
                        id="signin"
                    >
                        Sign in
                    </button>
                </div>
                <div class="col"></div>
            </div>
        </form>
        <!-- Register button -->
        <div class="text-center">
            <p class="mb-1">Not a member?</p>
            <div class="row">
                <div class="col"></div>
                <div class="col">
                    <a
                        class="btn btn-block btn-secondary"
                        id="register"
                        href="./register"
                        >Register</a
                    >
                </div>
                <div class="col"></div>
            </div>
        </div>
    </div>

    <!-- MDB -->
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
    // Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
        "use strict";
        const forms = document.querySelectorAll(".requires-validation");

        Array.from(forms).forEach(function (form) {
            document.getElementById("signin").addEventListener(
                "click",
                function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    } else {
                        const update = {
                            email: document.getElementById("email").value,
                            password: document.getElementById("password").value,
                        };

                        const options = {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(update),
                        };
                        function submitInfo() {
                            fetch(
                                "http://127.0.0.1:5555/api/users/login",
                                options
                            ).then(async (data) => {
                                if (data.status == "500") {
                                    let res = await data.json();
                                    document.getElementById("err").textContent =
                                        res.message;
                                    document.getElementById(
                                        "err"
                                    ).style.display = "block";
                                } else if (data.status == "200") {
                                    window.location.replace("/");
                                }
                            });
                        }
                        submitInfo();
                    }

                    form.classList.add("was-validated");
                    //passwordConfirmCheck();
                },
                false
            );
        });
    })();

    // Submit data to login
    // $(document).ready(() => {
    //     $("#signin").click(() => {
    //         if ($("#email").val() == "" || $("#password").val() == "") {
    //             return;
    //         }
    //         var data = {};
    //     });
    // });
</script>
