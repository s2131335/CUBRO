<%- include('./nav.ejs') %>
    <!-- <body> -->

<body>
    <div class="container">
        <div class="row">
            <div class="schedule-table pt-5">
                <table class="bg-white">
                    <thead class="border border-end-0 border-primary">
                        <tr>
                            <th>Routine</th>
                            <th>Mon</th>
                            <th>Tue</th>
                            <th>Wed</th>
                            <th>Thu</th>
                            <th>Fri</th>
                            <th>Sat</th>
                            <th class="last">Sun</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="day">08:30</td>
                            <% for (var i=0; i<7; i++) { %>
                                <td class="td" id=<%= i %>00></td>
                            <% } %>
                        </tr>
                        <tr>
                            <td class="day">09:30</td>
                            <% for (var i=0; i<7; i++) { %>
                                <td class="td" id=<%= i %>01></td>
                            <% } %>
                        </tr>
                        <tr>
                            <td class="day">10:30</td>
                            <% for (var i=0; i<7; i++) { %>
                                <td class="td" id=<%= i %>02></td>
                            <% } %>
                        </tr>
                        <tr>
                            <td class="day">11:30</td>
                            <% for (var i=0; i<7; i++) { %>
                                <td class="td" id=<%= i %>03></td>
                            <% } %>
                        </tr>
                        <tr>
                            <td class="day">12:30</td>
                            <% for (var i=0; i<7; i++) { %>
                                <td class="td" id=<%= i %>04></td>
                            <% } %>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="list-group list-group-light">

            <% data.course.forEach((c)=>{%>
                <% if (c.type=="Lecture"){ %>
            <li class="list-group-item" >
                <input
                    class="form-check-input"
                    type="checkbox"
                    value=<%= c.courseCode %><%= c.class %>
                    id=<%= c.courseCode %><%= c.class %><%= c.type %>
                    />
                <label
                    class="form-check-label"
                    for=<%= c.courseCode %><%= c.class %><%= c.type%>>
                    <div
                        class="d-flex
                        flex-row">
                        <div>
                            <%= c.courseCode %><%= c.class %>
                        </div>

                    </div>
                </label>
            </li>
                <% } %>
            <% }) %>
            </div>
        </div>
        <div class="row">
            <div>
                <button type="button" class="btn btn-primary" id="valid">Validate</button>
                <button type="button" class="btn btn-secondary" id="submit">Submit</button>
                <button type="button" class="btn btn-link" data-mdb-ripple-color="dark" id="reset">Reset</button>
            </div>
        </div>
    </div>
    </body>
    <script>
    var data = <%- JSON.stringify(data) %>;
    var course = data.course.map(c =>{
        return {
            courseCode: c.courseCode,
            venue: c.venue,
            class: c.class,
            timeSlot: c.timeSlot,
            type: c.type,
            displayed: false,
        };
    });
    function separateTimeSlots(arr) {
        let result = [];
        arr.forEach(obj => {
            for(var i=0; i<obj.timeSlot.length; i++){
                let firstChar = obj.timeSlot[i][0];
                let newObj = {...obj};
                newObj.timeSlot = obj.timeSlot.filter(slot => slot[0] === firstChar);
                if (i>0){
                    if (obj.timeSlot[i-1][0]!=firstChar){
                        result.push(newObj);
                    }
                }else if(i==0){
                    result.push(newObj);
                }
            }
        });
        return result;
    }

    var courses= separateTimeSlots(course);
    console.log(courses);
    $("#valid").click(()=>{
        var list=[];
        $('input[type="checkbox"]:checked').each(function() {
    // Do something with each checked checkbox
            list.push($(this).val());
        });
        console.log(list);
        list.forEach((code)=>{
            courses.forEach((c)=>{
                if ((c.class==code.charAt(8))&&(c.courseCode== code.slice(0,8))) {
                    if(c.displayed==false){
                        var span=c.timeSlot.length;
                        $(`#${c.timeSlot[0]}`).html(`<h4>${c.courseCode}</h4><p>${c.type}</p>`);
                        $(`#${c.timeSlot[0]}`).attr({
                            "rowspan" : `${span}`,
                            "class" : "active",
                        });
                        c.timeSlot.shift();
                        c.timeSlot.forEach((id)=>{
                            $(`#${id}`).hide();
                        });
                        c.displayed=true;

                    }
                }
            })
        });
        console.log(courses);
    })
    $("#reset").click(()=>{
            $(".td:hidden").show();
            $(".active").text(" ");
            $(".active").attr({
                "rowspan" : "1"
            });
            $(".active").removeClass("active");
            var course = data.course.map(c =>{
                return {
                    courseCode: c.courseCode,
                    venue: c.venue,
                    class: c.class,
                    timeSlot: c.timeSlot,
                    type: c.type,
                    displayed: false,
                };
            });
            courses= separateTimeSlots(course);
            $('input[type="checkbox"]:checked').each(function(button) {
                button.attr({
                            "rowspan" : `${span}`,
                            "class" : "active",
                        });
            });
    })
    </script>