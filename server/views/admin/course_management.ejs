<%- include('./nav.ejs') %>
<body>
	
	<div class="container pt-4 pb-5">
		<div class="row">
			<div class="col-6">
				<h3>Course Management</h3>
			</div>
			<!-- <div class="col-6 d-flex justify-content-end"><a class="btn btn-sm btn-primary align-self-center" href="/admin/add_course">+ Add Course</a></div> -->
			<div class="col-6 d-flex justify-content-end">	

				<a class="btn btn-sm btn-primary align-self-center" href=""  data-toggle="modal" data-target="#modalAddCourseForm">Add Course</a>
			</div>
		</div>
		
		<hr class="my-2" />
		<table class="table stripe mt-0" id="table" style="width: 100%">
			<thead>
				<tr>
					<th scope="col">Course Code</th>
					<th scope="col">Course Name</th>
					<th scope="col">Instructor</th>
					<th scope="col">Venue</th>
					<th scope="col">Seats</th>
					<th scope="col">Action</th>
				</tr>
			</thead>
			<tbody>
				<% for (var course of courses){ %>
				<tr>
					<td style="vertical-align: middle"><%=course.courseCode%></td>
					<td style="vertical-align: middle"><%=course.courseName%></td>
					<td style="vertical-align: middle"><%=course.instructor%></td>
					<td style="vertical-align: middle"><%=course.venue%></td>
					<td style="vertical-align: middle"><%=course.seat%></td>
					<td style="vertical-align: middle">
						<button
							id=<%=course._id%>
							class="btn btn-secondary btn-rounded btn-sm fw-bold"
							data-toggle="modal"
							data-target="#exampleModal3"
							type="button"
							name="edit"
							data-mdb-ripple-color="dark"
							onclick=""
						>
							Edit
						</button>
						<button
							class="btn btn-danger btn-rounded btn-sm fw-bold"
							data-mdb-toggle = "modal"
							data-mdb-target=#<%=course.courseCode %>D
							type="button"
						>
							Delete
						</button>
						<div class="modal fade" id=<%=course.courseCode%>D tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog">
							  <div class="modal-content">
								<div class="modal-header">
								  <h5 class="modal-title" id="exampleModalLabel"></h5>
								</div>
								<div class="modal-body">Confirm delete <%=course.courseCode %>?</div>
								<div class="modal-footer">
								  <button type="button" class="btn btn-secondary btn-rounded btn-sm fw-bold" data-mdb-dismiss="modal">Close</button>
								  <button type="button" class="btn btn-danger btn-rounded btn-sm fw-bold" 
								 id=<%=course._id %> data-mdb-dismiss="modal" name="delete" >Confirm</button>
								</div>
							  </div>
							</div>
						</div>
					</td>
				</tr>
				<%}%>
			</tbody>
		</table>

		<div class="modal fade" id="modalAddCourseForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
		  <div class="modal-content">
			<div class="modal-header text-center">
			  <h4 class="modal-title w-100 font-weight-bold">New Course</h4>
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body mx-3">
			  <form>
				  <!-- 2 column grid layout with text inputs for the first and last names -->
				  <div class="row">
					  <h4 class="text-muted" style="display: inline">Basic Information</h4>
					<div class="col-12 col-md-6 mb-4">
					  <div class="form-outline">
						<input type="text" id="inputCourseCode" class="form-control" />
						<label class="form-label" for="inputCourseCode">Course Code</label>
					  </div>
					</div>
					<div class="col-12 col-md-6 mb-4">
					  <div class="form-outline">
						<input type="text" id="inputCourseName" class="form-control" />
						<label class="form-label" for="inputCourseName">Course Name</label>
					  </div>
					</div>
				  </div>
	  
				  <!-- Text input -->
				  <div class="form-outline mb-4">
					<input type="text" id="inputDepartment" class="form-control" />
					<label class="form-label" for="inputDepartment">Department</label>
				  </div>
	  
				  <!-- Text input -->
				  <div class="form-outline mb-4">
					<input type="text" id="inputInstructor" class="form-control" />
					<label class="form-label" for="inputInstructor">Instructor</label>
				  </div>
	  
				  <!-- Email input -->
				  <div class="form-outline mb-4">
					<input type="email" id="inputVenue" class="form-control" />
					<label class="form-label" for="inputVenue">Venue</label>
				  </div>
	  
				  <!-- Number input -->
				  <div class="form-outline mb-4">
					<input type="number" id="inputCapacity" class="form-control" />
					<label class="form-label" for="inputCapacity">Capacity</label>
				  </div>
	  
				  <!-- Message input -->
				  <div class="form-outline mb-4">
					<textarea class="form-control" id="inputDescription" rows="4"></textarea>
					<label class="form-label" for="inputDescription">Description</label>
				  </div>
				  <div class="row mb-1">
					  <div class="col-10 d-flex aligns-items-center">
						  <h4 class="text-muted" style="display: inline">Meetings</h4>
						  <button class="btn btn-link btn-floating" type="button" id="add">
							  <i class="fa-solid fa-plus"></i>
						  </button>
					  </div>
				  </div>
				  <table id="meetingTable" class="table">
					<thead>
						<tr>
							<th scope="col">Weekday</th>
							<th scope="col">Start</th>
							<th scope="col">End</th>
							<th scope="col">Dates</th>
							<th scope="col">Action</th>
						</tr>
					</thead>
					<% var weekdays = ["Monday", "Tuesday", "Wednesday",
					"Thursday", "Friday", "Saturday","Sunday"] %>
					<tbody id="meetbody">
			
						<tr>
							<td>
								<div class="form">
									<select class="form-select form-select-lg" type="select">
										<% for (let i=0; i<7; i++){ %>
											<option  value=<%= i %> >
												<%= weekdays[i] %>
											</option>
										<% } %>
									</select>
								</div>
							</td>
							<td>
								<input
									type="text"
									class="form-control"
									value=""
									
								/>
							</td>
							<td>
								<input
									type="text"
									class="form-control"
									value=""
									
								/>
							</td>
							<td>
								<input name="date"
									type="text"
									class="form-control"
									value=""
								/>
							</td>
							<td>
								<button
									class="btn btn-danger btn-rounded btn-sm fw-bold"
									type="button"
									name="del"
								>
									Delete
								</button>
							</td>
						</tr>
					</tbody>
				</table>
				  <!-- Submit button -->
				  <div class="row">
					  <div class="col-12 col-md-6 mb-4">
						  <button id="modalReset" type="reset" class="btn btn-secondary btn-rounded btn-block">Reset</button>
					  </div>
					  <div class="col-12 col-md-6 mb-4">
						  <button type="submit" class="btn btn-primary btn-rounded btn-block">Save Change</button>
					  </div>
				  </div>
				</form>
			</div>
		  </div>
		</div>
	  </div>
<!-- 	  
	  <div class="text-center">
		<a href="" class="btn btn-default btn-rounded mb-4" data-toggle="modal" data-target="#modalAddCourseForm">Launch
		  Modal Register Form</a>
	  </div> -->
	</div>
</body>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.js"></script>
<script>
	$(document).ready(function () {
		$("#table").DataTable({
			columnDefs: [
				{
					orderable: false,
					targets: 5,
				},
			],
		});
	});
	$("[name='delete']").click(function(){
		var data=$(this).attr("id");
		console.log(data);
		fetch(
			"/api/courses/delete",
			{
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({_id:data}),
			}
		).then(async (data) => {
			if (data.status == "200") {
				window.location.replace(
					"/admin/courses"
				);
				alert("success!");
			} else {
				alert("error!");
			}
		});
	})

	$("[name='edit']").click(function(){
		var data=$(this).attr("id");
		console.log(data);
		window.location.replace(`/api/courses/edit/${data}`);
		})

	$("#add").click(()=>{
		$("#meetbody").append(
			`<tr class="newTr">
    				<td>
    					<div class="form">
							<select class="form-select form-select-lg" type="select">
								<% for (let i=0; i<7; i++){ %>
									<option  value=<%= i %>>
										<%= weekdays[i] %>
									</option>
								<% } %>
							</select>
						</div>
    				</td>
    				<td>
    					<input
    						type="text"
    						class="form-control"
    						value=""
    						
    					/>
    				</td>
					<td>
    					<input
    						type="text"
    						class="form-control"
    						value=""
    						
    					/>
    				</td>
    				<td>
    					<input
							name="date"
    						type="text"
    						class="form-control"
    						value=""
    						
    					/>
    				</td>
    				<td>
    					<button
    						class="btn btn-danger btn-rounded btn-sm fw-bold"
    						type="button"
							name="del"
    					>
    						Delete
    					</button>
    				</td>
    			</tr>
			`
		)
		$("[name='del']").click(function() {
  			$(this).closest("tr").remove();
		});
		
	});
	$("[name='del']").click(function() {
  			$(this).closest("tr").remove();
	});
	$("[name='date']").click(function() {
			console.log("click");
		});

$('#modalAddCourseForm').on('hidden.bs.modal', function (e) {
	$('#modalReset').click();
	$("#meetingTable tbody tr.newTr").remove();
})
</script>
<%- include('./nav_end.ejs') %>
