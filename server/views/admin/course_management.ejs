<%- include('./nav.ejs') %>
<body>
	<button
							class="btn btn-danger btn-rounded btn-sm fw-bold"
							data-toggle="modal"
							data-target="#Mdelete"
							type="button"
							data-mdb-ripple-color="dark"

						>
							Delete
						</button>
	<div class="modal fade" id="Mdelete" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
					<button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">Confirm delete?</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-light" data-mdb-dismiss="modal" data-mdb-ripple-color="dark">Cancel</button>
					<button type="button" class="btn btn-danger">Confirm</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Button trigger modal -->
	<button type="button" class="btn btn-primary" data-mdb-toggle="modal" data-mdb-target="#exampleModal">
		Launch demo modal
	</button>
	
	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
			<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
			<button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">...</div>
			<div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
			<button type="button" class="btn btn-primary">Save changes</button>
			</div>
		</div>
		</div>
	</div>
	<div class="container pt-4 pb-5">
		<div class="row">
			<div class="col-6">
				<h3>Course Management</h3>
			</div>
			<div class="col-6 d-flex justify-content-end"><a class="btn btn-sm btn-primary align-self-center" href="/admin/add-course">+ Add Course</a></div>
		</div>
		
		<hr class="my-2" />
		<table class="table stripe mt-0" id="table" style="width: 100%">
			<thead>
				<tr>
					<th scope="col">Course Code</th>
					<th scope="col">Course Name</th>
					<th scope="col">Instructor</th>
					<th scope="col">Venue</th>
					<th scope="col">Seats</th>
					<th scope="col">Action</th>
				</tr>
			</thead>
			<tbody>
				<% for (var course of courses){ %>
				<tr>
					<td><%=course.courseCode%></td>
					<td><%=course.courseName%></td>
					<td><%=course.instructor%></td>
					<td><%=course.venue%></td>
					<td><%=course.seat%></td>
					<td>
						<button
							class="btn btn-outline-danger btn-rounded btn-sm fw-bold"
							type="button"
							data-mdb-ripple-color="dark"
							onclick=""
						>
							Info
						</button>
						<button
							id="e+<%=course._id%>"
							class="btn btn-light btn-rounded btn-sm fw-bold"
							data-toggle="modal"
							data-target="#exampleModal3"
							type="button"
							data-mdb-ripple-color="dark"
							onclick=""
						>
							Edit
						</button>
						<button
							id="d+<%=course._id%>+<%=course.courseCode%>"
							class="btn btn-danger btn-rounded btn-sm fw-bold"
							data-mdb-toggle = "modal"
							data-mdb-target="#exampleModal"
							type="button"
							onclick="confirmDelete(this)"
						>
							Delete
						</button>

					</td>
				</tr>
				<%}%>
			</tbody>
		</table>

	</div>
</body>


<script>
	$(document).ready(function () {
		$("#table").DataTable({
			columnDefs: [
				{
					orderable: false,
					targets: 5,
				},
			],
		});
	});

	function confirmDelete(btn) {
		let data = btn.id.split("+");
        let confirmAction = confirm(`Are you sure to delete the course ${data[2]} ?`);
        if (confirmAction) {
			fetch(
				"/api/courses/delete",
				{
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({_id:data[1]}),
				}
			).then(async (data) => {
				if (data.status == "200") {
					window.location.replace(
						"/admin/courses"
					);
					alert("success!");
				} else {
					alert("error!");
				}
			});
      }
	}
	// function handleDelete(event) {
	// 	// alert("Delete");
	// }


</script>
<%- include('./nav_end.ejs') %>
