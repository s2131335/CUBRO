<%- include('./nav.ejs') %>

<body>
    <body>
        <div class="container">
            <div class="row">
                <div class="schedule-table pt-5">
                    <table class="bg-white">
                        <thead class="border border-end-0 border-primary">
                            <tr>
                                <th>Routine</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                                <th>Sat</th>
                                <th class="last">Sun</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="day">08:30</td>
                                <% for (var i=0; i<7; i++) { %>

                                    <td class="td" id=<%= i %>00></td>
                                <% } %>
                            </tr>
                            <tr>
                                <td class="day">09:30</td>
                                <% for (var i=0; i<7; i++) { %>
                                    <td class="td" id=<%= i %>01></td>
                                <% } %>
                            </tr>
                            <tr>
                                <td class="day">10:30</td>
                                <% for (var i=0; i<7; i++) { %>
                                    <td class="td" id=<%= i %>02></td>
                                <% } %>
                            </tr>
                            <tr>
                                <td class="day">11:30</td>
                                <% for (var i=0; i<7; i++) { %>
                                    <td class="td" id=<%= i %>03></td>
                                <% } %>
                            </tr>
                            <tr>
                                <td class="day">12:30</td>
                                <% for (var i=0; i<7; i++) { %>
                                    <td class="td" id=<%= i %>04></td>
                                <% } %>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $(document).ready(()=>{
        var data = <%- JSON.stringify(data) %>;
        var course = data.map(c =>{
            return {
                courseCode: c.courseCode,
                venue: c.venue,
                class: c.class,
                timeSlot: c.timeSlot,
                type: c.type,
                displayed: false,
            };
        });
        function separateTimeSlots(arr) {
            let result = [];
            arr.forEach(obj => {
                for(var i=0; i<obj.timeSlot.length; i++){
                    let firstChar = obj.timeSlot[i][0];
                    let newObj = {...obj};
                    newObj.timeSlot = obj.timeSlot.filter(slot => slot[0] === firstChar);
                    if (i>0){
                        if (obj.timeSlot[i-1][0]!=firstChar){
                            result.push(newObj);
                        }
                    }else if(i==0){
                        result.push(newObj);
                    }
                }
            });
            return result;
        }
        var courses= separateTimeSlots(course);
        courses.forEach((c)=>{
                    if(c.displayed==false){
                        var span=c.timeSlot.length;
                        $(`#${c.timeSlot[0]}`).html(`<h4>${c.courseCode}</h4><p>${c.type}</p>`);
                        $(`#${c.timeSlot[0]}`).attr({
                            "rowspan" : `${span}`,
                            "class" : "active",
                        });
                        c.timeSlot.shift();
                        c.timeSlot.forEach((id)=>{
                            $(`#${id}`).hide();
                        });
                        c.displayed=true;
                    }
            })
    })



</script>
<%- include('./nav_end.ejs') %>